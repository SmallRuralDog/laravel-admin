const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BMmEbvn8.js","assets/CXHZ_blF.js","assets/D4MQ2JwT.css","assets/BfI-IOdN.css","assets/BM9E9Sjr.js","assets/Dd7i4Jyi.css","assets/BRMP6TC_.js","assets/BML3T1-0.css"])))=>i.map(i=>d[i]);
import{r as N,o as U,c as $,w as x,a as D,C as F,d as p,b as H,u as W,N as V,m as q,e as L,f as y,s as z,g as J,h as K,i as G,j as Y}from"./CXHZ_blF.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}})();const Q=(e,t)=>{const s=e.__vccOpts||e;for(const[o,r]of t)s[o]=r;return s},X={};function Z(e,t){const s=N("router-view"),o=F;return U(),$(o,null,{default:x(()=>[D(s)]),_:1})}const ee=Q(X,[["render",Z]]),te="modulepreload",re=function(e){return"/admin/"+e},A={},w=function(t,s,o){let r=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),c=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));r=Promise.all(s.map(a=>{if(a=re(a),a in A)return;A[a]=!0;const l=a.endsWith(".css"),i=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${i}`))return;const u=document.createElement("link");if(u.rel=l?"stylesheet":te,l||(u.as="script",u.crossOrigin=""),u.href=a,c&&u.setAttribute("nonce",c),document.head.appendChild(u),l)return new Promise((d,g)=>{u.addEventListener("load",d),u.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${a}`)))})}))}return r.then(()=>t()).catch(n=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=n,window.dispatchEvent(c),!c.defaultPrevented)throw n})},v="admin-token",P=()=>!!localStorage.getItem(v),se=()=>localStorage.getItem(v),oe=e=>{localStorage.setItem(v,e)},k=()=>{localStorage.removeItem(v)},ne=Object.prototype.toString;function ae(e){return ne.call(e)==="[object String]"}const ie=e=>{const{name:t,id:s,path:o,params:r}=e;return{name:t||"",id:String(s),path:o,params:r}},Ue=p("tabBar",{state:()=>({cacheTabList:new Set(["home"]),tagList:[{name:"工作台",id:"home",path:"/home",params:{}}]}),getters:{getTabList(){return this.tagList},getCacheList(){return Array.from(this.cacheTabList)}},actions:{updateTabList(e){this.tagList.push(ie(e)),this.cacheTabList.add(e.id)},deleteTag(e,t){this.tagList.splice(e,1),this.cacheTabList.delete(t.name)},addCache(e){ae(e)&&e!==""&&this.cacheTabList.add(e)},deleteCache(e){this.cacheTabList.delete(e.name)},freshTabList(e){this.tagList=e,this.cacheTabList.clear(),this.tagList.filter(t=>!t.ignoreCache).map(t=>t.name).forEach(t=>this.cacheTabList.add(t))},resetTabList(){this.tagList=[],this.cacheTabList.clear(),this.cacheTabList.add("home")}}}),ce="light",ue=!1,le=!0,de=!0,he=!1,me=!1,fe=!1,ge=!1,pe="#165DFF",ve=220,be=!1,ye="desktop",we=!0,Le=!0,_e=[],Pe={},Se={theme:ce,colorWeak:ue,navbar:le,menu:de,topMenu:he,hideMenu:me,menuCollapse:fe,footer:ge,themeColor:pe,menuWidth:ve,globalSettings:be,device:ye,tabBar:we,menuFromServer:Le,serverMenu:_e,activeMenus:Pe},Me=window.AmisAdmin,m=H.create({baseURL:Me.apiBase,timeout:20*1e3,maxBodyLength:5*1024*1024,withCredentials:!0});m.interceptors.request.use(e=>(P()&&(e.headers={...e.headers,Authorization:`Bearer ${se()}`}),e.params={...e.params},e),function(e){return Promise.reject(e)});m.interceptors.response.use(e=>{const{status:t}=e.data;return t!==0?t===401?(B().logoutCallBack(),Promise.reject({data:{status:401,message:"未登录"}})):t===404?Promise.reject({data:{status:404,message:"抱歉，页面不见了～"}}):t===403?Promise.reject({data:{status:403,message:"对不起，您没有访问该资源的权限"}}):t===500?Promise.reject({data:{status:500,message:"抱歉，服务器出了点问题～"}}):Promise.reject(e.data):e},function(e){if(e.response){const{status:t}=e.response;if(t===401)return B().logoutCallBack(),Promise.reject({data:{status:401,message:"未登录"}});if(t===404)return Promise.reject({data:{status:404,message:"抱歉，页面不见了～"}});if(t===403)return Promise.reject({data:{status:403,message:"对不起，您没有访问该资源的权限"}});if(t===500)return Promise.reject({data:{status:500,message:"抱歉，服务器出了点问题～"}})}return Promise.reject(e.response)});const b={get(e,t){return new Promise((s,o)=>{m.get(e,{params:t}).then(r=>{s(r.data)}).catch(r=>{o(r.data)})})},post(e,t){return new Promise((s,o)=>{m.post(e,t,{}).then(r=>{s(r.data)}).catch(r=>{o(r.data)})})},put(e,t){return new Promise((s,o)=>{m.put(e,t).then(r=>{s(r.data)}).catch(r=>{o(r.data)})})},delete(e,t){return new Promise((s,o)=>{m.delete(e,{params:t}).then(r=>{s(r.data)}).catch(r=>{o(r.data)})})},upload(e,t){return new Promise((s,o)=>{m.post(e,t,{headers:{"Content-Type":"multipart/form-data"}}).then(r=>{s(r.data)}).catch(r=>{o(r.data)})})},download(e){const t=document.createElement("iframe");t.style.display="none",t.src=e,t.onload=function(){document.body.removeChild(t)},document.body.appendChild(t)}};function Ee(e){return b.post("/auth/login",e)}function Te(){return b.post("/auth/logout")}function Ce(){return b.get("/userMenus")}async function Ae(e,t){return await b.get(e,t)}const{set:j}=W(),S=p("app",{state:()=>({...Se,config:window.AmisAdmin}),getters:{appCurrentSetting(e){return{...e}},appDevice(e){return e.device},appAsyncMenus(e){return e.serverMenu},appActiveMenus(e){return e.activeMenus}},actions:{updateSettings(e){this.$patch(e)},toggleTheme(e){e?(this.theme="dark",document.body.setAttribute("arco-theme","dark"),j("arco-theme","dark",{path:"/"})):(this.theme="light",document.body.removeAttribute("arco-theme"),j("arco-theme","light",{path:"/"}))},toggleDevice(e){this.device=e},toggleMenu(e){this.hideMenu=e},async fetchServerMenuConfig(){try{const{data:e}=await Ce();this.serverMenu=e.menus,this.activeMenus=e.active_menus}catch(e){V.error({title:"错误",content:e.message})}},clearServerMenu(){this.serverMenu=[]},getMenuItemByUri(e){e=e.split("?")[0];const t=[];let s=!1;const o=r=>{var n;if(r.path==e){s=!0,t.push(r);return}(n=r.children)!=null&&n.length&&r.children.forEach(c=>{o(c)})};return this.serverMenu.forEach(r=>{s||o(r)}),t[0]}}}),M=q(),E=Symbol("ROUTE_CHANGE");let _;function ke(e){M.emit(E,e),_=e}function je(e,t=!0){M.on(E,e),t&&_&&e(_)}function Be(){M.off(E)}const Re=p("user",{state:()=>({name:void 0,avatar:void 0,job:void 0,organization:void 0,location:void 0,email:void 0,introduction:void 0,personalWebsite:void 0,jobName:void 0,organizationName:void 0,locationName:void 0,phone:void 0,registrationDate:void 0,accountId:void 0,certification:void 0,role:""}),getters:{userInfo(e){return{...e}}},actions:{switchRoles(){return new Promise(e=>{this.role=this.role==="user"?"admin":"user",e(this.role)})},setInfo(e){this.$patch(e)},resetInfo(){this.$reset()},async login(e){try{const t=await Ee(e);oe(t.data.access_token)}catch(t){throw k(),t}},logoutCallBack(){const e=S();this.resetInfo(),k(),Be(),e.clearServerMenu(),O({name:h.login},!0)},async logout(){try{await Te()}finally{this.logoutCallBack()}}}}),B=Re;L.configure({showSpinner:!1});const $e=p("pages",()=>{const e={},t=y({loading:!0,error:!1,status:0,errorMessage:"",pageJson:null,showMenu:!0,showHeader:!0}),s=async(a,l)=>{try{L.start(),t.value.loading=!0;const i=await Ae(a,l);i.action?(i.action=="jump"&&i.url&&(window.location.href=i.url),i.action=="renderPage"&&(t.value.showHeader=i.showHeader??!0,t.value.showMenu=i.showMenu??!0)):(t.value.showHeader=!0,t.value.showMenu=!0),e[a]=i.data,t.value.status=i.status??0,t.value.pageJson=e[a],t.value.error=!1}catch(i){const u=i;t.value.error=!0,t.value.status=u.status,t.value.errorMessage=u.message}finally{t.value.loading=!1,L.done()}},{appAsyncMenus:o}=z(S()),r=a=>{const l=[];let i=!1;const u=(d,g)=>{var C;if(d.id===a){i=!0,l.push(...g,d.name);return}(C=d.children)!=null&&C.length&&d.children.forEach(I=>{u(I,[...g,d.name])})};return o.value.forEach(d=>{i||u(d,[])}),l},n=y(),c=y([]);return je(a=>{n.value=a,c.value=r(a.id)},!0),{thisPage:t,pageBreadcrumb:c,getPageJson:s}}),Oe=J(),Ie=window.AmisAdmin.prefix,h={home:"home",login:"login"},f=K({history:G(`${Ie}/view/`),routes:[{path:"/",name:h.home,component:()=>w(()=>import("./BMmEbvn8.js"),__vite__mapDeps([0,1,2,3])),redirect:"home",children:[{path:"/:pathMatch(.*)*",name:"amis-view",component:()=>w(()=>import("./BM9E9Sjr.js"),__vite__mapDeps([4,1,2,5]))}]},{path:"/login",name:h.login,component:()=>w(()=>import("./BRMP6TC_.js"),__vite__mapDeps([6,1,2,7]))}]}),R=[h.login];f.beforeEach((e,t,s)=>{const o=P(),r=R.includes(e.name);!o&&!r?s({name:h.login}):o&&e.name===h.login?s({name:h.home}):s()});f.afterEach(e=>{const t=P(),s=R.includes(e.name);!t&&!s&&O({name:h.login},!0);const o=S().getMenuItemByUri(e.path);o&&ke(o)});function O(e,t=!1){(t?f.replace:f.push)(e).then(()=>{}).catch(o=>{console.log(o)})}const T=Y(ee);T.use(f);T.use(Oe);T.mount("#app");export{h as P,Q as _,Ue as a,S as b,f as c,B as d,je as l,Be as r,ke as s,O as t,$e as u};
