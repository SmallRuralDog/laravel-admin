const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/C97PHmtH.js","assets/CG0sQdSw.js","assets/YaukgyY6.css","assets/BGev51HP.css","assets/BoGoSb4o.js","assets/3y5aA-LC.css","assets/D2b6myEc.js","assets/jpWlrPvS.css"])))=>i.map(i=>d[i]);
import{r as N,o as U,c as $,w as x,a as D,C as F,b as H,u as W,d as M,N as V,m as q,e as _,f as w,s as z,g as J,h as K,i as G,j as Y}from"./CG0sQdSw.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const Q=(e,t)=>{const o=e.__vccOpts||e;for(const[n,r]of t)o[n]=r;return o},X={};function Z(e,t){const o=N("router-view"),n=F;return U(),$(n,null,{default:x(()=>[D(o)]),_:1})}const ee=Q(X,[["render",Z]]),te="modulepreload",re=function(e){return"/admin/"+e},L={},y=function(t,o,n){let r=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),c=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));r=Promise.all(o.map(a=>{if(a=re(a),a in L)return;L[a]=!0;const l=a.endsWith(".css"),i=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${i}`))return;const u=document.createElement("link");if(u.rel=l?"stylesheet":te,l||(u.as="script",u.crossOrigin=""),u.href=a,c&&u.setAttribute("nonce",c),document.head.appendChild(u),l)return new Promise((d,p)=>{u.addEventListener("load",d),u.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${a}`)))})}))}return r.then(()=>t()).catch(s=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=s,window.dispatchEvent(c),!c.defaultPrevented)throw s})},g="admin-token",b=()=>!!localStorage.getItem(g),oe=()=>localStorage.getItem(g),ne=e=>{localStorage.setItem(g,e)},R=()=>{localStorage.removeItem(g)},se="light",ae=!1,ie=!0,ce=!0,ue=!1,le=!1,de=!1,me=!1,he="#165DFF",fe=220,pe=!1,ge="desktop",ve=!0,we=!0,ye=[],_e={},Pe={theme:se,colorWeak:ae,navbar:ie,menu:ce,topMenu:ue,hideMenu:le,menuCollapse:de,footer:me,themeColor:he,menuWidth:fe,globalSettings:pe,device:ge,tabBar:ve,menuFromServer:we,serverMenu:ye,activeMenus:_e},Me=window.AmisAdmin,h=H.create({baseURL:Me.apiBase,timeout:20*1e3,maxBodyLength:5*1024*1024,withCredentials:!0});h.interceptors.request.use(e=>(b()&&(e.headers={...e.headers,Authorization:`Bearer ${oe()}`}),e.params={...e.params},e),function(e){return Promise.reject(e)});h.interceptors.response.use(e=>{const{status:t}=e.data;return t!==0?t===401?(j().logoutCallBack(),Promise.reject({data:{status:401,message:"未登录"}})):t===404?Promise.reject({data:{status:404,message:"抱歉，页面不见了～"}}):t===403?Promise.reject({data:{status:403,message:"对不起，您没有访问该资源的权限"}}):t===500?Promise.reject({data:{status:500,message:"抱歉，服务器出了点问题～"}}):Promise.reject(e.data):e},function(e){if(e.response){const{status:t}=e.response;if(t===401)return j().logoutCallBack(),Promise.reject({data:{status:401,message:"未登录"}});if(t===404)return Promise.reject({data:{status:404,message:"抱歉，页面不见了～"}});if(t===403)return Promise.reject({data:{status:403,message:"对不起，您没有访问该资源的权限"}});if(t===500)return Promise.reject({data:{status:500,message:"抱歉，服务器出了点问题～"}})}return Promise.reject(e.response)});const v={get(e,t){return new Promise((o,n)=>{h.get(e,{params:t}).then(r=>{o(r.data)}).catch(r=>{n(r.data)})})},post(e,t){return new Promise((o,n)=>{h.post(e,t,{}).then(r=>{o(r.data)}).catch(r=>{n(r.data)})})},put(e,t){return new Promise((o,n)=>{h.put(e,t).then(r=>{o(r.data)}).catch(r=>{n(r.data)})})},delete(e,t){return new Promise((o,n)=>{h.delete(e,{params:t}).then(r=>{o(r.data)}).catch(r=>{n(r.data)})})},upload(e,t){return new Promise((o,n)=>{h.post(e,t,{headers:{"Content-Type":"multipart/form-data"}}).then(r=>{o(r.data)}).catch(r=>{n(r.data)})})},download(e){const t=document.createElement("iframe");t.style.display="none",t.src=e,t.onload=function(){document.body.removeChild(t)},document.body.appendChild(t)}};function be(e){return v.post("/auth/login",e)}function Se(){return v.post("/auth/logout")}function Ee(){return v.get("/userMenus")}async function Ae(e,t){return await v.get(e,t)}const{set:B}=W(),S=M("app",{state:()=>({...Pe,config:window.AmisAdmin}),getters:{appCurrentSetting(e){return{...e}},appDevice(e){return e.device},appAsyncMenus(e){return e.serverMenu},appActiveMenus(e){return e.activeMenus}},actions:{updateSettings(e){this.$patch(e)},toggleTheme(e){e?(this.theme="dark",document.body.setAttribute("arco-theme","dark"),B("arco-theme","dark",{path:"/"})):(this.theme="light",document.body.removeAttribute("arco-theme"),B("arco-theme","light",{path:"/"}))},toggleDevice(e){this.device=e},toggleMenu(e){this.hideMenu=e},async fetchServerMenuConfig(){try{const{data:e}=await Ee();this.serverMenu=e.menus,this.activeMenus=e.active_menus}catch(e){V.error({title:"错误",content:e.message})}},clearServerMenu(){this.serverMenu=[]},getMenuItemByUri(e){e=e.split("?")[0];const t=[];let o=!1;const n=r=>{var s;if(r.path==e){o=!0,t.push(r);return}(s=r.children)!=null&&s.length&&r.children.forEach(c=>{n(c)})};return this.serverMenu.forEach(r=>{o||n(r)}),t[0]}}}),E=q(),A=Symbol("ROUTE_CHANGE");let P;function Ce(e){E.emit(A,e),P=e}function ke(e,t=!0){E.on(A,e),t&&P&&e(P)}function Le(){E.off(A)}const Re=M("user",{state:()=>({name:void 0,avatar:void 0,job:void 0,organization:void 0,location:void 0,email:void 0,introduction:void 0,personalWebsite:void 0,jobName:void 0,organizationName:void 0,locationName:void 0,phone:void 0,registrationDate:void 0,accountId:void 0,certification:void 0,role:""}),getters:{userInfo(e){return{...e}}},actions:{switchRoles(){return new Promise(e=>{this.role=this.role==="user"?"admin":"user",e(this.role)})},setInfo(e){this.$patch(e)},resetInfo(){this.$reset()},async login(e){try{const t=await be(e);ne(t.data.access_token)}catch(t){throw R(),t}},logoutCallBack(){const e=S();this.resetInfo(),R(),Le(),e.clearServerMenu(),O({name:m.login},!0)},async logout(){try{await Se()}finally{this.logoutCallBack()}}}}),j=Re;_.configure({showSpinner:!1});const Oe=M("pages",()=>{const e={},t=w({loading:!0,error:!1,status:0,errorMessage:"",pageJson:null,showMenu:!0,showHeader:!0}),o=async(a,l)=>{try{_.start(),t.value.loading=!0;const i=await Ae(a,l);i.action?(i.action=="jump"&&i.url&&(window.location.href=i.url),i.action=="renderPage"&&(t.value.showHeader=i.showHeader??!0,t.value.showMenu=i.showMenu??!0)):(t.value.showHeader=!0,t.value.showMenu=!0),e[a]=i.data,t.value.status=i.status??0,t.value.pageJson=e[a],t.value.error=!1}catch(i){const u=i;t.value.error=!0,t.value.status=u.status,t.value.errorMessage=u.message}finally{t.value.loading=!1,_.done()}},{appAsyncMenus:n}=z(S()),r=a=>{const l=[];let i=!1;const u=(d,p)=>{var k;if(d.id===a){i=!0,l.push(...p,d.name);return}(k=d.children)!=null&&k.length&&d.children.forEach(T=>{u(T,[...p,d.name])})};return n.value.forEach(d=>{i||u(d,[])}),l},s=w(),c=w([]);return ke(a=>{s.value=a,c.value=r(a.id)},!0),{thisPage:t,pageBreadcrumb:c,getPageJson:o}}),Be=J(),je=window.AmisAdmin.prefix,m={home:"home",login:"login"},f=K({history:G(`${je}/view/`),routes:[{path:"/",name:m.home,component:()=>y(()=>import("./C97PHmtH.js"),__vite__mapDeps([0,1,2,3])),redirect:"home",children:[{path:"/:pathMatch(.*)*",name:"amis-view",component:()=>y(()=>import("./BoGoSb4o.js"),__vite__mapDeps([4,1,2,5]))}]},{path:"/login",name:m.login,component:()=>y(()=>import("./D2b6myEc.js"),__vite__mapDeps([6,1,2,7]))}]}),I=[m.login];f.beforeEach((e,t,o)=>{const n=b(),r=I.includes(e.name);!n&&!r?o({name:m.login}):n&&e.name===m.login?o({name:m.home}):o()});f.afterEach(e=>{const t=b(),o=I.includes(e.name);!t&&!o&&O({name:m.login},!0);const n=S().getMenuItemByUri(e.path);n&&Ce(n)});function O(e,t=!1){(t?f.replace:f.push)(e).then(()=>{}).catch(n=>{console.log(n)})}const C=Y(ee);C.use(f);C.use(Be);C.mount("#app");export{m as P,Q as _,S as a,f as b,j as c,ke as l,Le as r,Ce as s,O as t,Oe as u};
